<div class="container">
    <div id="app-stories"></div>
    <script type="text/javascript" xml="space">// <![CDATA[
        require([
            'jquery',
            'https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js',
    
        ], function ($, Swiper) {
    
    
      $.ajax({
      url: 'https://run.mocky.io/v3/cb0ea131-a0b0-4ba7-9749-4d41a3afcc4f',
      method: 'get',
      dataType: 'json',
      success: function(response) {
        if(response?.items) {
          const storiesOptions = [];
          
          response.items.forEach((story) => {
            const readyStory = {
              id: story.story_id,
              name: story.name,
              enable: story.enable,
              photo: story.thumbnail,
              items: [],
            };
                console.log('resPoma',readyStory);
            
            readyStory.items = story.contents.map((item) => ({
              id: item.content_id,
              type: item.type,
              url: item.content_path,
              prod: item.link,
              goods: item.products?.constructor == Object ? Object.values(item.products) : []
            }));
    
            storiesOptions.push(readyStory);
      
          });
          
          stroriesAjaxResponse(storiesOptions);
        }
      }
    });
    
    function stroriesAjaxResponse(stories) {
      new StoriesSlider(document.getElementById("app-stories"), { stories });
    }
    
    
    class StoriesSlider  {
  constructor(element, options) {
    this.element = element;
    this.options = options;
    this.currentStory = 0;
    this.storiesIndexes = this.getInitialStoriesIndexes();
    this.muted = true;
    this.opened = false;
    this.init();
  }

  
  makeStoriesCircles() {
    this.storiesCircles = document.createElement("div");
    this.storiesCircles.classList.add("stories-cirle");
    let template = '<div class="container"><div class="stories-cirle-wrapper">';

    if (this.options?.stories?.constructor === Array ) {
      this.options.stories.forEach((story) => {
        template += this.getStoryCircleTemplate(story.name, story.photo);
      });
    }

    template += '</div></div>';

    this.storiesCircles.innerHTML = template;

    this.element.append(this.storiesCircles);

    [...this.storiesCircles.querySelectorAll('.stories-cirle-wrapper__circle')].forEach((circle, index) => {
      circle.addEventListener('click', () => {
        if(this.modal.classList.contains('stories-slider-none')) {
          this.modal.classList.remove('stories-slider-none');

          // const currentItem = this.options.stories[this.modalSwiper.activeIndex].items[this.storiesIndexes[this.modalSwiper.activeIndex]];

          // if(currentItem.goods.length) {
          //   console.log(currentItem.goods.length);
          //   console.log('ok');
          //   this.showGoods.innerHTML = this.getGoodsTemplate(currentItem);
          //   this.goodsButton.classList.remove('show-goods-button__hide');
          // }
          // else {
          //   console.log('no');
          //   this.showGoods.innerHTML = '';
          //   this.goodsButton.classList.add('show-goods-button__hide');
          // }

        }

        if(!this.opened) {
          this.initEvents();
          this.opened = true;
        }

        this.modalSwiper.slideTo(index);
        this.playVideo();

        const currentItem = this.options.stories[this.modalSwiper.activeIndex].items[this.storiesIndexes[this.modalSwiper.activeIndex]];
        this.showGoods.innerHTML = this.getGoodsTemplate(currentItem);

        //[...this.modalSwiper.slides[this.modalSwiper.activeIndex].querySelectorAll('.player-wrapper__timeline')][this.storiesIndexes[this.modalSwiper.activeIndex]].classList.add('player-wrapper__timeline-active');
      });
    });
  }

  makeStoriesModal(children) {
    if (children?.constructor !== String) return "";

    if (!this.modal) {
      this.modal = document.createElement("div");
      this.modal.classList.add("slider-app-stroies", "stories-slider-none");
      this.showGoods = document.createElement('div');
      this.showGoods.classList.add('show-goods');
      this.showGoods.innerHTML = this.getGoodsTemplate();
      this.mountedSound = document.createElement('div');
      this.mountedSound.classList.add('sound_muted');
      this.mountedSound.innerHTML = this.makeStoriesModalMuted();
      const closeButton = this.getModalCloseButton();

      const swiperElement = this.makeSwiperOnModal();

      swiperElement.querySelector(".swiper-wrapper").innerHTML = children;

      this.modal.append(swiperElement);
      this.modal.append(this.mountedSound);
      this.modal.append(closeButton);
      this.element.append(this.modal);
      this.modal.append(this.showGoodsButton());
      this.modal.append(this.showGoods);
      this.modal.append(this.owerflowBg());
    }
  }

  closeModal() {
    this.pauseVideo();
    this.modal.classList.add('stories-slider-none');
  }
  
  // -------------------

  makeStoriesModalMuted() {
    return `
    <div class="player-wrapper__muted">
        <div class="player-wrapper__off-muted">
            <svg width="22" height="22" viewBox="0 0 20 20" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M13 0V9.93934L11.5 8.43934V3.17108L8.60617 5.54551L7.54036 4.4797L13 0Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M13 14.0438L17.9697 19.0304L19.0304 17.9697L1.55941 0.439579L0.498747 1.50024L4.31891 5.33333H0V14.6667H6.5L13 20V14.0438ZM11.5 12.5387V16.8289L7.03662 13.1667H1.5V6.83333H5.81384L11.5 12.5387Z"></path></svg>
            <span class="stories-modal__mute-label">Звук выключен</span>
        </div>
        <div class="player-wrapper__on-muted">
            <svg width="22" height="22" viewBox="0 0 20 20" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.03662 13.1667L11.5 16.8289V3.17108L7.03662 6.83333H1.5V13.1667H7.03662ZM0 14.6667V5.33333H6.5L13 0V20L6.5 14.6667H0Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.75 10C19.75 12.412 18.6368 14.7895 16.4785 16.5776L15.5215 15.4224C17.3632 13.8968 18.25 11.9311 18.25 10C18.25 8.06887 17.3632 6.1032 15.5215 4.57756L16.4785 3.42244C18.6368 5.21051 19.75 7.58799 19.75 10Z"></path></svg>
            <span class="stories-modal__mute-label">Звук включен</span>
        </div>
    </div>
    `
  }

  // -------------------

  makeSwiperOnModal() {
 
    const swiperMainElement = document.createElement("div");
    swiperMainElement.classList.add("stories-swiper");
    swiperMainElement.innerHTML = '<div class="swiper-wrapper"></div>';

    this.modalSwiper = new Swiper(swiperMainElement, {
      slidesPerView: this.options.stories.length,
      spaceBetween: 30,
      centeredSlides: true,
      // autoHeight: true,
      noSwiping: false,
      noSwipingClass: "swiper-slide",
      // lazyLoad: true,
      breakpoints: {
        320: {
          slidesPerView: 1,
          spaceBetween: 0
        },
        600: {
          slidesPerView: 1.25,
          spaceBetween: 0
        },
        620: {
          slidesPerView: 1.28,
          spaceBetween: 0
        },
        640: {
          slidesPerView: 1.32,
          spaceBetween: 0
        },
        658: {
          slidesPerView: 1.35,
          spaceBetween: 0
        },
        698: {
          slidesPerView: 1.43,
          spaceBetween: 0
        },
        728: {
          slidesPerView: 1.5,
          spaceBetween: 0
        },
        825: {
          slidesPerView: 1.7,
          spaceBetween: 0
        },
        992: {
          slidesPerView: 2,
          spaceBetween: 0
        },
        1090: {
          slidesPerView: 2.1,
          spaceBetween: 0,
        },
        1100: {
          slidesPerView: 2.45,
          spaceBetween: 0,
        },
        1110: {
          slidesPerView: 2.52,
          spaceBetween: 0,

        },
        1290: {
          slidesPerView: 2.8,
          spaceBetween: 0,
        },
        1320: {
          slidesPerView: 2.8,
          spaceBetween: 0
        },
        1420: {
          slidesPerView: 2.9,
          spaceBetween: 0
        },
        1540: {
          slidesPerView: 3.3,
          spaceBetween: 0
        }
      }
    });

    return swiperMainElement;
  }

  makeStoriesTemplate() {
    let template = "";

    if (this.options?.stories?.constructor === Array) {
      this.options.stories.forEach((story, index) => {
        let storyItems = "";

        if (story?.items?.constructor === Array) {
          const needItem = [...story.items].shift();

          storyItems += this.getStoryItemTemplate(story, needItem);
        }

        template += storyItems;
      });
    }

    return template;
  }

  getInitialStoriesIndexes() {
    const initial = {};

    this.options.stories.forEach((_story, index) => {
      initial[index] = 0;
    });

    return initial;
  }


 
  showGoodsButton() {
    this.goodsButton = document.createElement('div');
    this.goodsButton.classList.add('show-goods-button');
    this.goodsButton.innerHTML = 'Используемые товары';
    this.goodsButton.onclick = (e) => {

    this.swiperInitPod();

      const originalElement = e.currentTarget || e.originalTarget;
      const goodsElement = originalElement.nextElementSibling;

      const visibleBg = originalElement.parentNode.querySelector('.overflowBg');
            visibleBg.classList.toggle('overflowBg__visible');

      if(goodsElement) {
        goodsElement.classList.toggle('show-goods_opened');
        let isOpen = goodsElement.classList.contains('show-goods_opened');

        if(isOpen) {
          this.pauseVideo(false);
        }
        else {
          this.playVideo();
        }

        if(this.goodsButton.innerHTML = isOpen) {
          this.goodsButton.innerHTML = 'Скрыть товары';
          this.goodsButton.classList.add('addColorBtn');
        } else {
          this.goodsButton.innerHTML = 'Используемые товары';
          this.goodsButton.classList.remove('addColorBtn');
        }
      }

      e.stopPropagation();
    }

    return this.goodsButton;
  }

  owerflowBg = () => {
    this.overflowBg = document.createElement('div');
    this.overflowBg.classList.add('overflowBg');
    this.overflowBg.onclick = (e) => {
      
      const originalElement = e.currentTarget || e.originalTarget;

      const visibleBg = originalElement.parentNode.querySelector('.overflowBg')

      if(visibleBg) {
        visibleBg.classList.toggle('overflowBg__visible');
        let isOpen = visibleBg.classList.contains('overflowBg__visible');
        visibleBg.parentNode.querySelector('.show-goods').classList.remove('show-goods_opened');

        if(isOpen) {
          this.pauseVideo(false);
        }
        else {
          this.playVideo();
        }

        if(this.goodsButton.innerHTML = isOpen) {
          this.goodsButton.innerHTML = 'Скрыть товары';
          this.goodsButton.classList.add('addColorBtn');
        } else {
          this.goodsButton.innerHTML = 'Используемые товары';
          this.goodsButton.classList.remove('addColorBtn');
        }
      }

    }

    return this.overflowBg;
  }

  
  getStoryCircleTemplate(name, photo) {
    return `
    <div class="stories-cirle-wrapper__circle">
      <div class="stories-cirle-wrapper__picture">
        <img src="${photo}" alt="${name}"></img>
      </div>
      <div class="stories-cirle-wrapper__title">${name}</div>
    </div>`;
  }


  getStoryItemTemplate(story, item) {
    return `
      <div class="swiper-slide">
        <div class="player">
          <div class="player-wrapper">
              <div class="player-wrapper__timeline-wrp">
              ${this.getStoryItemTimelineTemplate(story)}
              </div>
              <div class="player-wrapper__nav">
                  <div class="player-wrapper__prev"></div>
                  <div class="player-wrapper__next"></div>
              </div>
              <div class="player-wrapper__chunk-wrp">
                ${this.getStoryItemTypeTemplate(item, story)}
              </div>
              <div class="player-wrapper__story-info">
                <div class="player-wrapper__story-info-picture" style="background-image: url('${story.photo}')"></div>
                <div class="player-wrapper__story-info-title">${story.name}</div>
                <div class="player-wrapper__story-info-date"></div>
              </div>
          </div>
          ${this.preloader()}
        </div>
      </div>`;
  }


  getStoryGoodsLinkTemplate(prod, name) {
    return `
      <div class="stories-goods">
          <a class="stories-goods__link" href="${prod}">${name}</a>
      </div>`;
  }


  preloader() {
    return `
      <div class="lds-ripple"><div></div><div></div></div>
    `;
  }

  getStoryItemTimelineTemplate(story) {
    let template = '';

    story.items.forEach(() => {
      template += `<div class="player-wrapper__timeline">
        <div class="player-wrapper__process"></div>
      </div>`;
    });

    return template;
  }

  

  getGoodsTemplate(storyItem) {
    if(!storyItem?.goods) return '';

    let template = `
    <div class="swiper swiperStoriesProd">
      <div class="swiper-wrapper">`;
            
    storyItem.goods.forEach((item) => {
      template += this.getGoodTemplate(item);
    });

    template += `
      </div>
      <div class="swiper-button-next swiper-button-next-stories-prod"></div>
      <div class="swiper-button-prev swiper-button-prev-stories-prod"></div>
    </div>
    `;

    return template;
  }

  
  swiperInitPod = () => {
    var swiperProd = new Swiper(".swiperStoriesProd", {
      // slidesPerView: 'auto',
      // spaceBetween: 20,
      loop: true,
      navigation: {
        nextEl: ".swiper-button-next-stories-prod",
        prevEl: ".swiper-button-prev-stories-prod",
      },
      breakpoints: {
        320: {
          slidesPerView: 2.5,
          spaceBetween: 20
        },
        576: {
          slidesPerView: 2.5,
          spaceBetween: 20
        },
        768: {
          slidesPerView: 3.5,
          spaceBetween: 20
        },
        992: {
          slidesPerView: 4,
          spaceBetween: 20
        },
        1200: {
          slidesPerView: 6,
          spaceBetween: 0
        },
      }
    });

    swiperProd.update();
  }

  getGoodTemplate(item) {
    return `
      <div class="swiper-slide">
        <div class="player-wrapper__chunk-goods-wrp-item">
          <div class="player-wrapper__chunk-goods-wrp-content">
              <div class="player-wrapper__chunk-goods-wrp-image">
                <a href="#">
                  <img src="${item.thumbnail ?? 'https://simg2.marwin.kz/media/catalog/product/cache/550cf8d20d514ab5650dc2adb71f19c7/s/c/nioh_collection_ps5.png'}" alt=""></img>
                </a>
              </div>
              <div class="player-wrapper__chunk-goods-wrp-type">
                <a href="#">${item.name}</a>
              </div>
              <div class="player-wrapper__chunk-goods-wrp-prices">
                <div>
                  <div class="player-wrapper__chunk-goods-wrp-price${item.price > item.special_price ? ' player-wrapper__chunk-goods-wrp-price_underline' : ''}">
                    ${item.price}
                  </div>
                <div class="player-wrapper__chunk-goods-wrp-price_discount">${item.special_price}</div>
                </div>
                <button class="player-wrapper__chunk-goods-wrp-add-cart" title="Добавить в корзину"></button>
            </div>
          </div>
        </div>
      </div>
    `
  }

  
  getStoryItemTypeTemplate(item, story) {

    const typeFormat = item.url.slice(item.url.lastIndexOf('.') + 1);

    let template = '<div class="player-wrapper__chunk player-wrapper__chunk-active">';
    if (item.type == "video") {
      template += `
        <video class="player-wrapper__chunk-video" preload="metadata" playsinline ${this.muted ? 'muted': ''}>
          <source src="${item.url}" type="${item.type}/${typeFormat}">
        </video>
      `;
    }
    if (item.type == "image") {
      template += `<img src="${item.url}" alt="${item.type}"></img>`;
    }
   
    template += '</div>';

    return template;
  }

  getModalCloseButton() {
    const button = document.createElement("div");
    button.classList.add('close_strories');
    button.innerHTML = `<div class="close_strories_mark">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.9394 9.00006L0.469727 1.53039L1.53039 0.469727L9.00006 7.9394L16.4697 0.469727L17.5304 1.53039L10.0607 9.00006L17.5304 16.4697L16.4697 17.5304L9.00006 10.0607L1.53039 17.5304L0.469727 16.4697L7.9394 9.00006Z"></path></svg>
    </div>`;
    button.addEventListener('click', () => {
      this.closeModal();
    });

    return button;
  }

  // clickPauseVideo() {
  //   let video = this.modal.querySelector('video');
  //   console.log(video.pause());
  // }

  // clickPlayVideo() {
  //   let video = this.modal.querySelector('video');
  //   console.log(video.play());
  // }
  
  initEvents() {
    [...this.modalSwiper.wrapperEl.querySelectorAll('.swiper-slide')].forEach((storyElement, index) => {
      storyElement.querySelector('.player-wrapper__next').addEventListener('click', this.nextStoryItem);
      storyElement.querySelector('.player-wrapper__prev').addEventListener('click', this.prevStoryItem);
      storyElement.addEventListener('click', () => this.slideToStoryItem(index));
      //storyElement.addEventListener('mousedown', () => this.clickPauseVideo(), false);
      //storyElement.addEventListener('mouseup', () => this.clickPlayVideo(), false);
      // storyElement.addEventListener('mouseover', () => this.clickPlayVideo());
      // тут можно вызвать еще одну функцию на удержание пауза
    });

    this.modalSwiper.on('slideChange', () => {
      const activeIndex = this.modalSwiper.activeIndex;
      const prevIndex = this.modalSwiper.previousIndex;
      const activeElement = this.modalSwiper.slides[activeIndex];
      const prevElement = this.modalSwiper.slides[prevIndex];

      if(activeElement) {
        const video = activeElement.querySelector('video');
        const currentItem = this.options.stories[this.modalSwiper.activeIndex].items[this.storiesIndexes[this.modalSwiper.activeIndex]];
        activeElement.querySelector('.player-wrapper__timeline-wrp').querySelector('.player-wrapper__timeline').classList.add('player-wrapper__timeline-active');

        if(video) {
          video.play();
        }

        if(currentItem.goods.length > 0) {
          this.showGoods.innerHTML = this.getGoodsTemplate(currentItem);
          this.goodsButton.classList.remove('show-goods-button__hide');
        }
        else {
          this.showGoods.innerHTML = '';
          this.goodsButton.classList.add('show-goods-button__hide');
        }
      }

      if(prevElement) {
        const video = prevElement.querySelector('video');

        if(video) {
          video.pause();
          video.currentTime = 0;
        }
      }
    });
  }


  playVideo() {
    const activeIndex = this.modalSwiper.activeIndex;
    const slides = this.modalSwiper.slides.length > 0 ? this.modalSwiper.slides : [...this.modalSwiper.wrapperEl.querySelectorAll('.swiper-slide')];
    const activeElement = slides[activeIndex];
    
    if(activeElement) {
      const video = activeElement.querySelector('video');
      const timeLineAll = [...activeElement.querySelectorAll('.player-wrapper__timeline')];
      const currentItemIndex = this.storiesIndexes[this.modalSwiper.activeIndex];
      
      if(video) {
        video.play();
      }

      timeLineAll.forEach((timeLine, index) => {
        if(index <= currentItemIndex && !timeLine.classList.contains('player-wrapper__timeline-active')) {
          timeLine.classList.add('player-wrapper__timeline-active');
        }
        else if(index > currentItemIndex && timeLine.classList.contains('player-wrapper__timeline-active')) {
          timeLine.classList.remove('player-wrapper__timeline-active');
        }
      });
    }
  }

  pauseVideo(returnToStart = true) {
    const activeIndex = this.modalSwiper.activeIndex;
    const slides = this.modalSwiper.slides.length > 0 ? this.modalSwiper.slides : [...this.modalSwiper.wrapperEl.querySelectorAll('.swiper-slide')];
    const activeElement = slides[activeIndex];
    
    if(activeElement) {
      const video = activeElement.querySelector('video');
      if(video) {
        video.pause();
        if(returnToStart) {
          video.currentTime = 0;
        }
      }
    }
  }


  // здесь переключается сторис вперед
  nextStoryItem = (e) => {
    
    if(!e.target.closest('.swiper-slide').classList.contains('swiper-slide-active')) return false;
    
    const playerWrapper = e.target.closest('.player-wrapper');
    const playerChunk = playerWrapper.querySelector('.player-wrapper__chunk-wrp');
    
    if(this.storiesIndexes[this.modalSwiper.activeIndex] < this.options.stories[this.modalSwiper.activeIndex].items.length - 1) {
      this.storiesIndexes[this.modalSwiper.activeIndex] += 1;
      const currentItem = this.options.stories[this.modalSwiper.activeIndex].items[this.storiesIndexes[this.modalSwiper.activeIndex]];
      
      playerChunk.innerHTML = this.getStoryItemTypeTemplate(currentItem);
      
      const video = playerChunk.querySelector('video');

      //переключаем плашки в право
      /*let timeLineActive = e.target.parentNode.parentNode.querySelector('.player-wrapper__timeline-active');
          if(timeLineActive.nextElementSibling) {
            timeLineActive.classList.remove('player-wrapper__timeline-active');
            timeLineActive.nextElementSibling.classList.add('player-wrapper__timeline-active');
          }*/

      // тут по клику получаем длительность видео
        /*if(video) {
          video.addEventListener('loadedmetadata', (e) => {
            let resDuration = e.target.duration.toFixed() + '000';
            let result = Number(resDuration);
              console.log(result);
          });
        }*/
      
      this.playVideo();

      if(currentItem.goods.length > 0) {
        this.showGoods.innerHTML = this.getGoodsTemplate(currentItem);
        this.goodsButton.classList.remove('show-goods-button__hide');
      }
      else {
        this.showGoods.innerHTML = '';
        this.goodsButton.classList.add('show-goods-button__hide');
      }
    }
    else if(this.storiesIndexes[this.modalSwiper.activeIndex] >= this.options.stories[this.modalSwiper.activeIndex].items.length - 1) {
      const video = playerChunk.querySelector('video');
      
      if(video) {
        video.pause();
      }

      if(this.modalSwiper.activeIndex == this.options.stories.length - 1) {
        this.closeModal();
      }
      else {
        this.modalSwiper.slideNext();
      }
    }

    e.stopPropagation();
  }

  // здесь переключается сторис назад
  prevStoryItem = (e) => {
    if(!e.target.closest('.swiper-slide').classList.contains('swiper-slide-active')) return false;

    const playerChunk = e.target.closest('.player-wrapper').querySelector('.player-wrapper__chunk-wrp');

    if(this.storiesIndexes[this.modalSwiper.activeIndex] !== 0) {
      this.storiesIndexes[this.modalSwiper.activeIndex] -= 1;
      const currentItem = this.options.stories[this.modalSwiper.activeIndex].items[this.storiesIndexes[this.modalSwiper.activeIndex]];

      playerChunk.innerHTML = this.getStoryItemTypeTemplate(currentItem);
      //const video = playerChunk.querySelector('video');


      /*let timeLineActive = e.target.parentNode.parentNode.querySelector('.player-wrapper__timeline-active');
          if(timeLineActive.previousElementSibling) {
            timeLineActive.classList.remove('player-wrapper__timeline-active');
            timeLineActive.previousElementSibling.classList.add('player-wrapper__timeline-active');
          }*/


      this.playVideo();

      if(currentItem.goods.length > 0) {
        this.showGoods.innerHTML = this.getGoodsTemplate(currentItem);
        this.goodsButton.classList.remove('show-goods-button__hide');
      }
      else {
        this.showGoods.innerHTML = '';
        this.goodsButton.classList.add('show-goods-button__hide');
      }
    }
    else if(this.modalSwiper.activeIndex !== 0) {
      const video = playerChunk.querySelector('video');

      if(video) {
        video.pause();
      }

      this.modalSwiper.slidePrev();
    }

    e.stopPropagation();
  }

//Получаем время
  getDataTime() {
    let toDay = new Date();
    let options = {
       month: 'short',
       day: 'numeric' 
      };
    let result = toDay.toLocaleString('ru', options);
    return result;
  }

  ifGonePage() {
    
    document.addEventListener("visibilitychange", function() {
      if (document.hidden) {
       const stopVideo = document.querySelectorAll('.player-wrapper__chunk-video');
              stopVideo.forEach(elm => {
                elm.pause();
              });
      } else {
        const stopVideo = document.querySelectorAll('.player-wrapper__chunk-video');
              stopVideo.forEach(elm => {
                elm.play();
              });
      }
    });
  }


  turnOnTurnoffSound() {
    let soundBtn = this.modal.querySelector('.player-wrapper__muted');
    let changeMuted = soundBtn;
    changeMuted.addEventListener('click', () => {
        this.muted = !this.muted;
        changeMuted.querySelector('.player-wrapper__on-muted').classList.toggle('change_on-muted');
        changeMuted.querySelector('.player-wrapper__off-muted').classList.toggle('change_off-muted');
        this.modalSwiper.slides.forEach((slide) => {
          const video = slide.querySelector('video');
          if(video) {
            video.muted = this.muted;
          }
        });
    });
  }

  slideToStoryItem(index) {
    if(this.modalSwiper.activeIndex == index) return false;
    this.modalSwiper.slideTo(index);
  }

  init() {
    this.makeStoriesCircles();
    this.getDataTime();
    this.preloader();
    // this.ifGonePage();
    // this.showChunkGoods();
    this.makeStoriesModal(this.makeStoriesTemplate());
    //setTimeout(() => this.initEvents(), 1000)
    this.turnOnTurnoffSound();
    // this.swiperInitPod();
    
  }
}

window.StoriesSlider = StoriesSlider;


})

    // ]]></script>
<style xml="space"><!--
 *::-webkit-input-placeholder {
  color: #666;
  opacity: 1;
}

*:-moz-placeholder {
  color: #666;
  opacity: 1;
}

*::-moz-placeholder {
  color: #666;
  opacity: 1;
}

*:-ms-input-placeholder {
  color: #666;
  opacity: 1;
}

* {
  box-sizing: border-box;
}

*:before, *:after {
  box-sizing: border-box;
}

body {
  min-width: 320px;
  height: 100%;
  position: relative;
  line-height: 1.4;
  font-weight: 400;
  overflow-x: hidden;
  margin: 0;
}

p {
  margin: 0;
}

a {
  text-decoration: none;
  outline: none;
  display: inline-block;
  color: #fff;
}

img {
  max-width: 100%;
  height: auto;
  vertical-align: bottom;
}

ul li,
ol li {
  list-style: none;
  display: block;
  margin: 0;
}

span {
  display: inline-block;
}

ul, ol {
  display: block;
  margin: 0;
  padding-left: 0;
}

button {
  outline: none;
  border: 0;
  padding: 0;
  cursor: pointer;
}

h1, h2, h3, h4, h5, h6 {
  margin: 0;
  font-weight: normal;
}

.site-wrap {
  overflow: hidden;
}

.container {
  margin: 0 auto;
  position: relative;
  padding: 0 15px;
  width: 100%;
  max-width: 1200px;
}

.stories-swiper .swiper {
  width: 100%;
  height: 100%;
}

.stories-swiper .swiper-slide {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh !important;
}

.stories-swiper .swiper-slide img {
  display: block;
  width: 100%;
  height: 100%;
  -o-object-fit: cover;
     object-fit: cover;
}

.stories-cirle-wrapper {
  max-width: 1095px;
  width: 100%;
  margin: 0 auto;
  display: flex;
  overflow-x: auto;
}
.stories-cirle-wrapper::-webkit-scrollbar {
  width: 0;
}
.stories-cirle-wrapper__circle {
  width: 90px;
  min-height: 117px;
  margin: 0 5px;
  flex: none;
  text-align: center;
  cursor: pointer;
}
.stories-cirle-wrapper__circle:first-child {
  margin-left: 0;
}
.stories-cirle-wrapper__circle:last-child {
  margin-right: 0;
}
.stories-cirle-wrapper__picture {
  margin-bottom: 5px;
  border: 3px solid #b3b3b3;
  border-radius: 50%;
  padding: 3px;
  transition: border-color 0.3s;
}
.stories-cirle-wrapper__picture:hover {
  border-color: #74716f;
}
.stories-cirle-wrapper__picture img {
  border-radius: 50%;
}
.stories-cirle-wrapper__title {
  font-size: 15px;
  color: #000;
  text-transform: capitalize;
}

.slider-app-stroies {
  min-height: 100vh;
  max-height: 100vh;
  height: 100vh;
  min-width: 100vw;
  max-width: 100vw;
  width: 100vw;
  position: fixed;
  top: 0;
  left: 0;
  background-color: rgba(0, 0, 0, 0.9490196078);
  -webkit-animation: fadeInFromNone 0.5s;
          animation: fadeInFromNone 0.5s;
  z-index: 99999999999;
}

.sound {
  padding: 10px;
}

.stories-slider-none {
  display: none;
}

.stories-swiper .swiper-slide {
  transition: transform 0.4s ease;
}
.stories-swiper .swiper-slide:not(.swiper-slide-active) {
  transform: scale(0.8, 0.8) !important;
}

.swiperStoriesProd .swiper {
  width: 100%;
  height: 100%;
}

.swiperStoriesProd .swiper-slide {
  display: flex;
  justify-content: center;
  align-items: center;
}

.player {
  width: 473px;
  height: 100%;
  display: flex;
  align-items: center;
  margin: 50px auto 0 auto;
}
.player-wrapper {
  position: relative;
  min-height: 100vh;
}
.player-wrapper::before {
  content: "";
  background: #000;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
}
.player-wrapper__muted {
  position: relative;
  color: #fff;
  background: transparent;
  font-weight: 600;
}
.player-wrapper__on-muted {
  display: none;
}
.player-wrapper__timeline-wrp {
  display: flex;
  align-content: center;
  height: 3px;
  margin-bottom: 5px;
  position: absolute;
  left: 5px;
  top: 5px;
  right: 5px;
  z-index: 999;
}
.player-wrapper__timeline {
  background-color: hsla(0deg, 0%, 100%, 0.2);
  height: 100%;
  flex: 1;
  margin-left: 3px;
}
.player-wrapper__timeline:first-child {
  margin-left: 0;
}
.player-wrapper__process {
  background-color: #fff;
  height: 100%;
  width: 0;
}
.player-wrapper__story-info {
  display: flex;
  align-items: center;
  position: absolute;
  top: 20px;
  font-size: 14px;
  color: #fff;
}
.player-wrapper__story-info-picture {
  width: 35px;
  height: 35px;
  background-repeat: no-repeat;
  background-size: contain;
  border-radius: 50%;
  margin: 0 10px;
}
.player-wrapper__story-info-title {
  font-weight: 600;
}
.player-wrapper__prev {
  position: absolute;
  left: 0;
  bottom: 0;
  top: 0;
  width: 50%;
  z-index: 9;
}
.player-wrapper__next {
  position: absolute;
  right: 0;
  bottom: 0;
  top: 0;
  width: 50%;
  z-index: 9;
}
.player-wrapper__chunk {
  display: none;
}
.player-wrapper__chunk-video {
  width: 100%;
  height: auto;
  max-height: 100%;
}
.player-wrapper__chunk-active {
  display: block;
}
.player-wrapper__chunk-goods {
  margin-top: 50px;
}
.player-wrapper__chunk-goods-text span {
  position: relative;
}
.player-wrapper__chunk-goods-text span::before {
  content: "";
  position: absolute;
  left: -13px;
  top: 50%;
  display: inline-block;
  border-bottom: 2px solid;
  border-left: 2px solid;
  width: 6px;
  height: 6px;
  transform: rotate(135deg) translateY(17%);
}
.player-wrapper__timeline-active {
  background: #fff;
  width: 0;
}
.player-wrapper__chunk-goods-wrp-type {
  margin-top: 5px;
}
.player-wrapper__chunk-goods-wrp-type a {
  color: #4d4d4d;
}
.player-wrapper__chunk-goods-wrp {
  display: flex;
  justify-content: center;
}
.player-wrapper__chunk-goods-wrp-item {
  position: relative;
  max-width: 220px;
  height: 320px;
  color: #000;
  border-radius: 15px;
  padding: 15px;
  transition: 0.2s box-shadow;
}
.player-wrapper__chunk-goods-wrp-item:hover {
  box-shadow: 0 0 5px 0px #d3d3d3;
}
.player-wrapper__chunk-goods-wrp-item:hover a {
  color: blue;
}
.player-wrapper__chunk-goods-wrp-prices {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 177px;
  position: absolute;
  bottom: 15px;
}
.player-wrapper__chunk-goods-wrp-price {
  font-size: 16px;
  color: #727272;
  font-weight: 600;
}
.player-wrapper__chunk-goods-wrp-price_discount {
  font-size: 20px;
  color: #4d4d4d;
}
.player-wrapper__chunk-goods-wrp-price {
  position: relative;
  text-decoration: none;
}
.player-wrapper__chunk-goods-wrp-price:before {
  content: "";
  border-bottom: 1px solid red;
  position: absolute;
  width: 79%;
  height: 50%;
  transform: rotate(-9deg);
}
.player-wrapper__chunk-goods-wrp-add-cart {
  background-color: #dd4003;
  width: 76px;
  padding: 0 3px;
  background-size: 33px;
  color: #fff;
  border: 1px solid #f15a2c;
  background: url(https://simg.marwin.kz/static/version1662626232/frontend/Astrio/meloman/ru_RU/images/cart.svg) #f15a2c no-repeat center;
  border-radius: 5px;
  height: 40px;
  transition: 0.3s background-color;
}
.player-wrapper__chunk-goods-wrp-add-cart:hover {
  background-color: #bd3c08;
}

.swiperStoriesProd {
  position: relative;
  padding-top: 20px;
  padding-bottom: 10px;
  margin: 0 30px;
}
.swiperStoriesProd-wrp {
  position: relative;
  max-width: 1600px;
  margin: 0 auto;
}

.swiperStoriesProd .swiper-button-prev:after, .swiper-rtl .swiper-button-next:after,
.swiperStoriesProd .swiper-button-next:after, .swiper-rtl .swiper-button-prev:after {
  content: "";
}

.swiperStoriesProd .swiper-button-next-stories-prod {
  background-color: #f3f3f3;
  background-image: url("https://simg.marwin.kz/static/version1662626232/frontend/Astrio/meloman/ru_RU/images/nav_next.svg");
  background-repeat: no-repeat;
  background-position: center;
  background-size: 10px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  right: 0;
}

.swiperStoriesProd .swiper-button-prev-stories-prod {
  background-color: #f3f3f3;
  background-image: url("https://simg.marwin.kz/static/version1662626232/frontend/Astrio/meloman/ru_RU/images/nav_prev.svg");
  background-repeat: no-repeat;
  background-position: center;
  background-size: 10px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  left: 0;
}

.swiperStoriesProd .swiper-button-next.swiper-button-next-stories-prod.swiper-button-disabled,
.swiperStoriesProd .swiper-button-prev.swiper-button-prev-stories-prod.swiper-button-disabled {
  opacity: 0;
}

.show-goods {
  display: none;
  position: absolute;
  -webkit-animation: fadeInFromNone 0.5s;
          animation: fadeInFromNone 0.5s;
  left: 0;
  right: 0;
  top: 525px;
  z-index: 3;
  background-color: #fff;
  box-shadow: 0px -2px 5px 0px rgba(0, 0, 0, 0.4);
  height: 100%;
  z-index: 3;
}
.show-goods_opened {
  display: block;
}

.overflowBg__visible {
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  background: #000;
  opacity: 0.7;
  z-index: 2;
  transition: 0.3s background;
}

.show-goods-hide {
  background: #000;
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
}

@-webkit-keyframes fadeInFromNone {
  0% {
    display: none;
    opacity: 0;
  }
  100% {
    display: block;
    opacity: 1;
  }
}

@keyframes fadeInFromNone {
  0% {
    display: none;
    opacity: 0;
  }
  100% {
    display: block;
    opacity: 1;
  }
}
.chunk-goods-text-show {
  display: none;
}

.hide {
  display: none;
}

.show {
  display: none;
}

.player-wrapper__timeline-active ~ .player-wrapper__timeline > .player-wrapper__process {
  width: 0;
}

.sound_muted {
  padding: 20px;
  position: absolute;
  left: 15px;
  top: 15px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  z-index: 2;
  cursor: pointer;
}

.stories-modal__mute-label {
  position: absolute;
  white-space: nowrap;
  top: 49%;
  padding-left: 10px;
  transform: translateY(-50%);
  left: 17px;
}

.close_strories {
  padding: 20px;
  background: transparent;
  position: absolute;
  right: 15px;
  top: 15px;
  z-index: 2;
  cursor: pointer;
}

.stories-goods {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
}

.show-goods-button {
  position: absolute;
  transform: translateX(-50%);
  color: #fff;
  white-space: nowrap;
  cursor: pointer;
  z-index: 10;
  left: 50%;
  font-size: 17px;
  bottom: 15px;
  transition: 0.3s;
}
.show-goods-button::before {
  content: "";
  position: absolute;
  display: inline-block;
  border-bottom: 2px solid;
  border-left: 2px solid;
  transform: rotate(135deg);
  left: -15px;
  top: 10px;
  width: 6px;
  height: 6px;
}
.show-goods-button__hide {
  display: none;
}
.change_on-muted {
  display: block;
}

.change_off-muted {
  display: none;
}

.addColorBtn {
  color: #000;
  bottom: 15px;
}
.addColorBtn::before {
  transition: 0.2s;
  transform: rotate(315deg);
  top: 8px;
}

.lds-ripple {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  display: inline-block;
  width: 80px;
  height: 80px;
  z-index: -1;
}
.lds-ripple div {
  position: absolute;
  border: 4px solid #fff;
  opacity: 1;
  border-radius: 50%;
  -webkit-animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;
          animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;
}
.lds-ripple div:nth-child(2) {
  -webkit-animation-delay: -0.5s;
          animation-delay: -0.5s;
}

@-webkit-keyframes lds-ripple {
  0% {
    top: 36px;
    left: 36px;
    width: 0;
    height: 0;
    opacity: 0;
  }
  5% {
    top: 36px;
    left: 36px;
    width: 0;
    height: 0;
    opacity: 1;
  }
  100% {
    top: 0px;
    left: 0px;
    width: 72px;
    height: 72px;
    opacity: 0;
  }
}

@keyframes lds-ripple {
  0% {
    top: 36px;
    left: 36px;
    width: 0;
    height: 0;
    opacity: 0;
  }
  5% {
    top: 36px;
    left: 36px;
    width: 0;
    height: 0;
    opacity: 1;
  }
  100% {
    top: 0px;
    left: 0px;
    width: 72px;
    height: 72px;
    opacity: 0;
  }
}
@media screen and (max-width: 992px) {
  .stories-cirle-wrapper__circle {
    width: 70px;
  }
}
@media screen and (max-width: 768px) {
  .stories-cirle-wrapper__circle {
    width: 60px;
    min-height: 100px;
  }
  .stories-cirle-wrapper__title {
    font-size: 12px;
  }
  .show-goods {
    top: 46%;
  }
  .swiperStoriesProd {
    margin: 0;
  }
  .show-goods_opened {
    top: 530px;
  }
}
@media screen and (max-width: 600px) {
  .player {
    margin: 0;
    max-width: unset;
  }
  .stories-modal__mute-label {
    display: none;
  }
  .sound_muted {
    top: 65px;
    left: 0;
  }
}
@media screen and (max-width: 530px) {
  .player-wrapper__chunk-goods-wrp-item {
    height: 310px;
  }
  .show-goods_opened {
    top: 540px;
  }
}
@media screen and (max-width: 478px) {
  .player-wrapper__chunk-goods-wrp-add-cart {
    width: 50px;
  }
  .player-wrapper__chunk-goods-wrp-prices {
    width: 135px;
  }
  .player-wrapper__chunk-goods-wrp-price,
.player-wrapper__chunk-goods-wrp-price_discount {
    font-size: 15px;
  }
  .player-wrapper__chunk-goods-wrp-item {
    max-width: 166px;
    min-width: 140px;
  }
  .player-wrapper__chunk-goods-wrp-type a {
    font-size: 14px;
  }
  .player-wrapper__chunk-goods-wrp-item {
    height: 275px;
  }
  .player-wrapper__chunk-goods-wrp-item {
    margin-left: 15px;
  }
  .show-goods_opened {
    top: 578px;
  }
}
@media screen and (max-width: 390px) {
  .player-wrapper__chunk-goods-wrp-item {
    height: 270px;
  }
  .player-wrapper__chunk-goods-wrp-prices {
    width: 110px;
  }
}
@media only screen and (max-width: 768px) {
  .animated {
    /*CSS transitions*/
    transition-property: none !important;
    /*CSS transforms*/
    transform: none !important;
    /*CSS animations*/
    -webkit-animation: none !important;
    animation: none !important;
  }
}/*# sourceMappingURL=main.css.map */
    --></style>
</div>